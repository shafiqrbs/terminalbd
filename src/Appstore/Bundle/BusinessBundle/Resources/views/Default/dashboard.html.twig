{% extends '::base.html.twig' %}
{% block body %}
    <div class="container-fluid">
        <!-- END PAGE HEADER-->
        <div class="portlet box green">
            <div class="portlet-title">
                <div class="caption"><i class="icon icon-medkit"></i> Dashboard</div>
            </div>
            <div class="portlet-body">
                <div class="row-fluid" >
                     <div class="span5">
                        <div class="btn-group">
                            <a class="btn black big">Quick Links <i class="m-icon-big-swapright m-icon-white"></i></a>
                            {% if (app.user.granted("ROLE_BUSINESS_INVOICE"))  %}
                                <a href="{{ path('business_invoice_new') }}" class="btn red big"><i class="icon-plus-sign"></i> Add Invoice </a>
                                <a href="{{ path('business_invoice') }}" class="btn blue big"><i class="icon-th-large"></i> Invoice </a>
                            {% endif %}
                            {% if (app.user.granted("ROLE_DOMAIN_ACCOUNTING_SALES"))  %}
                            <a href="{{ path('account_sales_business_outstanding') }}" class="btn yellow big"><i class="icon-money"></i> Due Receive</a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="span4">
                        <div class="btn-group">
                            {% if (app.user.granted("ROLE_BUSINESS_PURCHASE"))  %}
                                <a href="{{ path('business_purchase_new') }}" class="btn red big"><i class="icon-plus-sign"></i> Add Purchase</a>
                                <a href="{{ path('business_purchase') }}" class="btn green big"><i class="icon-th-large"></i> Purchase</a>
                            {% endif %}
                            {% if (app.user.granted("ROLE_DOMAIN_ACCOUNTING_PURCHASE"))  %}
                                <a href="{{ path('account_purchase_business_outstanding') }}" class="btn yellow big"><i class="icon-money"></i> Payment</a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="span2">
                        <div class="btn-group">
                            {% if (app.user.granted("ROLE_DOMAIN_ACCOUNTING_EXPENDITURE"))  %}
                            <a href="{{ path('account_expenditure_new') }}" class="btn purple big"><i class="icon-plus-sign"></i> Expenditure</a>
                            {% endif %}
                            {% if (app.user.granted("ROLE_DOMAIN_ACCOUNTING_JOURNAL"))  %}
                            <a href="{{ path('account_journal_new') }}" class="btn blue big"><i class="icon-money"></i> Journal</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="portlet-body form">
                <div class="form-actions portlet box purple">
                    <div class="portlet-title">
                        <div class="caption"><i class="icon icon-money"></i> Today Cash Overview</div>
                        <div class="actions">
                            <div class="btn-group">
                                <a class="btn red" href="{{ path('account_transaction_cash_overview') }}"><i class="icon-bar-chart"></i> Cash Summary</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix">&nbsp;</div>
                <table class="table table-bordered table-striped table-condensed flip-content ">
                    <thead class="flip-content ">
                    <tr class="head-blue">
                        <th class="numeric">Cash Account</th>
                        <th class="numeric" >Opening Balance</th>
                        <th class="numeric" >Receive</th>
                        <th class="numeric" >Payment</th>
                        <th class="numeric" >Closing Balance</th>
                    </tr>
                    </thead>
                    <tbody>
                    {#{{ dump(transactionCashOverviews.transactionBalances[1][0]['debit']) }}#}
                    {% set totalOpen = 0 %}
                    {% set totalDebit = 0 %}
                    {% set totalCredit = 0 %}
                    {% for mode in transactionCashOverviews.result %}
                        {% set open = transactionCashOverviews.openingBalance[mode.transactionId]|default(0) %}
                        {% set debit = transactionCashOverviews.transactionBalances[mode.transactionId][loop.index0].debit|default(0)  %}
                        {% set credit = transactionCashOverviews.transactionBalances[mode.transactionId][loop.index0].credit|default(0)  %}
                        {% set totalOpen = totalOpen + open %}
                        {% set totalDebit = totalDebit + debit %}
                        {% set totalCredit = totalCredit + credit %}

                        <tr>
                            <th class="numeric">{{ mode.transactionName }}</th>
                            <th class="numeric">{{ open|number_format }}</th>
                            <th class="numeric">{{ debit|number_format }}</th>
                            <th class="numeric">{{ credit|number_format }}</th>
                            <th class="numeric" >{{ ((open + debit)-credit)|number_format }}</th>
                        </tr>
                    {% endfor %}
                    <tr>
                        <th class="numeric">Total Amount</th>
                        <th class="numeric">{{ totalOpen|number_format }}</th>
                        <th class="numeric">{{ totalDebit|number_format }}</th>
                        <th class="numeric">{{ totalCredit|number_format }}</th>
                        <th class="numeric" >{{ ((totalOpen + totalDebit)-totalCredit)|number_format }}</th>
                    </tr>
                    </tbody>

                </table>
            </div>
            <div class="clearfix"></div>
            <div class="portlet-body form">
                <div class="form-actions portlet box red">
                    <div class="portlet-title">
                        <div class="caption"><i class="icon icon-medkit"></i> Today Expenditure Overview</div>
                    </div>
                </div>
                <div class="clearfix">&nbsp;</div>
                <table class="table table-bordered table-striped table-condensed flip-content ">
                    {% if expenditureOverview is not empty %}
                        {% set total = 0 %}
                        {% for expenditure in expenditureOverview %}
                            {% set total = total+expenditure.amount %}
                            <tr>
                                <th class="numeric" >{{ expenditure.categoryName }}</th>
                                <td class="numeric" >{{ expenditure.amount|number_format }}</td>
                            </tr>
                        {% endfor %}
                        <tfoot>
                        <tr><th>Grand Total</th><th>{{ total|number_format }}</th></tr>
                        </tfoot>
                    {% endif %}
                </table>
            </div>
            <div class="clearfix"></div>
            <div class="portlet-body form">
                <div class="form-actions portlet box blue">
                    <div class="portlet-title">
                        <div class="caption"><i class="icon icon-medkit"></i> Today Sales Overview</div>
                        <div class="actions">
                            <div class="btn-group">
                                <a class="btn red" href="{{ path('business_report_sales_summary') }}"><i class="icon-bar-chart"></i> Sales Reports</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix">&nbsp;</div>
                <table class="table table-bordered table-striped table-condensed flip-content ">
                    <tr>
                        <th class="numeric" >Sub-total Amount</th>
                        <td class="numeric" >{{ salesCashOverview.subTotal|number_format }}</td>
                    </tr>
                    <tr>
                        <th class="numeric" >Discount</th>
                        <td class="numeric" >{{ salesCashOverview.totalDiscount|number_format }}</td>
                    </tr>
                    <tr>
                        <th class="numeric" >Net Total</th>
                        <td class="numeric" >{{ salesCashOverview.total|number_format }}</td>
                    </tr>
                    <tr>
                        <th class="numeric" >Payment</th>
                        <td class="numeric" >{{ salesCashOverview.totalPayment|number_format }}</td>
                    </tr>
                    <tr>
                        <th class="numeric" >Receivable</th>
                        <th class="numeric" >{{ salesCashOverview.totalDue|number_format }}</th>
                    </tr>
                </table>
            </div>
            <div class="clearfix"></div>
            <div class="portlet-body form">
                <div class="form-actions portlet box green">
                    <div class="portlet-title">
                        <div class="caption"><i class="icon icon-medkit"></i> Today Purchase Overview</div>
                        <div class="actions">
                            <div class="btn-group">
                                <a class="btn red" href="{{ path('business_report_purchase_summary') }}"><i class="icon-bar-chart"></i> Purchase Reports</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix">&nbsp;</div>
                <table class="table table-bordered table-striped table-condensed flip-content ">
                    <tr>
                        <th class="numeric" >Total Amount</th>
                        <td class="numeric" >{{ purchaseCashOverview.total|number_format }}</td>
                    </tr>
                    <tr>
                        <th class="numeric" >Payment</th>
                        <td class="numeric" >{{ purchaseCashOverview.totalPayment|number_format }}</td>
                    </tr>
                    <tr>
                        {% set due = (purchaseCashOverview.total - purchaseCashOverview.totalPayment) %}
                        <th class="numeric" >{% if due >= 0 %}Payable {% else %}Receivable{% endif %}</th>
                        <th class="numeric" >{{ due|number_format }}</th>
                    </tr>
                </table>
            </div>
            <div class="clearfix"></div>
        </div>


    </div>
    <style>
        .dashboard-stat .visual{
            width: auto;
            float: none;
            padding:0;
            padding-top: 15px;
            padding-bottom: 15px;
        }
        .dashboard-stat .visual:hover{
            text-decoration: none;
        }
        .dashboard-stat .more {
            clear: both;
            display: block;
            padding: 5px 10px 5px 10px;
            text-transform: uppercase;
            font-size: 16px;
            color: #fff;
            opacity:1;
            font-weight: bold;
        }
        .unstyled{
            height: 100px;
        }
    </style>
{% endblock %}
{% block cssBlock %}
    {% stylesheets filter='cssrewrite'
    '@MedicineBundle/Resources/public/css/invoice.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock  %}
{% block javascriptBlock %}
    {{ parent() }}
    {% javascripts
    '@MedicineBundle/Resources/public/js/approveProcess.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock  %}
{% block documentready %}
    {{ parent() }}
    Charts.init();
    Charts.initCharts();
    Charts.initPieCharts();
{% endblock %}

