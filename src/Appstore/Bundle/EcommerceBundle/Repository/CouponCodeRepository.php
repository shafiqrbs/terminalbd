<?php

namespace Appstore\Bundle\EcommerceBundle\Repository;
use Appstore\Bundle\EcommerceBundle\Entity\Coupon;
use Appstore\Bundle\EcommerceBundle\Entity\CouponCode;
use Appstore\Bundle\InventoryBundle\Entity\InventoryConfig;
use Doctrine\ORM\EntityRepository;

/**
 * CouponCodeRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CouponCodeRepository extends EntityRepository
{

    public function getCouponId(){

        $passcode =substr(str_shuffle(str_repeat('0123456789',5)),0,4);
        $t = microtime(true);
        $micro = ($passcode + floor($t));
        return $micro;
    }

    public function insert(Coupon $coupon)
    {
        $em = $this->_em;
        $total = $coupon->getQuantity();
        for($i=1; $total >= $i ; $i ++ ){
            $cc = New CouponCode();
            $cc->setCoupon($coupon);
            $cc->setCode($this->getCouponId());
            $em->persist($cc);
            $em->flush($cc);
       }

    }

}
