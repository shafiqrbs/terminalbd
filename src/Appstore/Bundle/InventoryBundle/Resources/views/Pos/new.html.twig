{% extends '::pos-base.html.twig' %}
{% block body %}
    {#{% if config.templateCss is not empty %}
    <style>{{ config.templateCss|raw }}</style>

    {% endif %}#}
    <div class="row-fluid" id="pos-area">
        <div class="portlet box green">
            <div class="portlet-body">
                <div style="background: #3598dc; padding: 15px">

                        <div class="row-fluid">
                            <div class="span8">
                                {% if config.usingBarcode == "purchase-item"  %}
                                <div class="input-prepend input-append span4" style="margin-right: 18px">
                                    <span class="add-on add-on-height"><i class="icon-barcode"></i></span>
                                    <input type="text" id="barcode" name="barcode" required="required" class="m-wrap span11" placeholder="Enter product barcode" autocomplete="off">
                                </div>
                                <div class="separator">
                                    <input type="text" id="barcodeNo" name="barcodeNo" class="span4 m-wrap m-wrap-bg" value="" autocomplete="off" placeholder="Search product">
                                </div>
                                <div class="separator">
                                    <input type="text" id="name" name="name" class="span4 m-wrap m-wrap-bg select2StockItem" value="" autocomplete="off" placeholder="Search product">
                                </div>
                                {% else %}
                                    <div class="input-prepend input-append span11">
                                        <span class="add-on add-on-height"><i class="icon-barcode"></i></span>
                                        <input type="text" id="barcode" name="barcode" required="required" class="m-wrap span6" placeholder="Enter product barcode" autocomplete="off">
                                        <span class="add-on add-on-height"><i class="icon-search"></i></span>
                                        <input type="text" id="name" name="name" class="span6 m-wrap m-wrap-bg" value="" autocomplete="off" placeholder="Search product">
                                    </div>
                                {% endif %}
                            </div>
                            <div class="span4">
<h4 class="text-left top-payment">PRODUCT & PAYMENT INFORMATION</h4>
                            </div>
                        </div>

                </div>
                <div class="row-fluid">
                    <div class="span8">
                        <div class="row-fluid">
                        <div class="tabbable tabbable-custom" style="float: left; width: 80%">
                            <div class="tab-content">
                                <div class="tab-pane tab-height active" id="all-product">
                                    <div class="row-fluid productBox" >
                                        <div class="loader loader-double"></div>
                                        <div class="" id="items"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ul  class="nav nav-tabs tabs-left categoryBox" id="category-nav" style="width: 20%; float:left; background-color:#444d58">
                            <li class="active span12"><a href="#all-product" data-toggle="tab" class="saveButton" aria-expanded="false">All Products</a></li>
                            {% for category in categories %}
                                <li><a href="#{{ category.slug }}" data-toggle="tab" class="saveButton" aria-expanded="false">{{ category.name }}</a></li>
                            {% endfor %}
                        </ul>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="row-fluid">

                              <div class="portlet box royal-blue">
                                    {#<div class="portlet-title">
                                        <div class="switch-field">
                                            {% set process = ['Order','Kitchen','Hold','Reserved','Cancle'] %}
                                            {% for pro in process %}
                                                <input type="radio" data-id="{{ entity.id }}" id="{{ pro }}" {% if pro == entity.process  %} checked="checked" {% endif %} data-action="{{ path('restaurant_tableinvoice_process',{'id':entity.id,'process':pro}) }}"   class="invoice-process"  name="process" value="{{ pro }}"/>
                                                <label for="{{ pro }}">{{ pro }}</label>
                                            {% endfor %}
                                        </div>
                                    </div>#}
                                    <div class="portlet-body">
                                        {{ form_start(form) }}
                                        {{ form_row(form._token) }}
                                        <div class="transactionBox" id="transaction-box">
                                            <div class="payment-info">
                                                <div class="clearfix"></div>
                                                <table class="table table-bordered">
                                                    <thead class="flip-content ">
                                                    <tr class="head-royal-blue">
                                                        <th class="numeric">&nbsp;</th>
                                                        <th class="numeric span8 product-title-name">Product</th>
                                                        <th class="numeric product-title">Price</th>
                                                        <td class="numeric span2">&nbsp;</td>
                                                        <th class="numeric product-title">Total</th>
                                                        <th class="numeric"></th>
                                                    </tr>
                                                    </thead>
                                                    <tbody id="invoiceParticulars">
                                                    {% if  cart.contents is not empty %}
                                                    {% for item in cart.contents %}
                                                        <tr id="remove-{{ item.rowid }}">
                                                            <td>{{ loop.index }}.</td>
                                                            <td class="numeric product-title">{{ item.name }}</td>
                                                            <td class="numeric">{{ item.price }}</td>
                                                            <td class="">
                                                                <div class="input-append" style="margin-bottom: 0!important;">
                                                                <span class="input-group-btn">
              <a href="javascript:" data-action="{{ path('inventory_pos_item_update',{'product':item.rowid}) }}" class="btn black btn-number-pos mini" data-type="minus" data-id="{{ item.rowid }}"  data-text="{{ item.rowid }}" data-title="{{ item.price }}"  data-field="quantity"> <span class="fa fa-minus"></span> </a>
                                                                   <input type="text" class="form-control inline-m-wrap updateProduct btn-qnt-particular" data-id="{{ item.rowid }}"  id="quantity-{{ item.rowid }}" name="quantity-{{ item.rowid }}" data-title="{{ item.price }}" value="{{ item.quantity }}" data-action="{{ path('restaurant_tableinvoice_product_update',{'product':item.rowid}) }}" min="1" max="100">
                                                                  <a href="javascript:" data-action="{{ path('inventory_pos_item_update',{'product':item.rowid}) }}" class="btn black btn-number-pos mini"  data-type="plus" data-id="{{ item.rowid }}" data-title="{{ item.price }}"  data-text="{{ item.rowid }}" data-field="quantity"> <span class="fa fa-plus"></span></a></span>
                                                                </div>
                                                            </td>
                                                            <td class="numeric product-title"><strong id="subTotal-{{ item.rowid }}">{{ (item.quantity * item.price)|number_format(2) }}</strong></td>
                                                            <td class="numeric">
                                                                <a id="{{ item.rowid }}" data-id="{{ item.rowid }}" data-url="{{ path('inventory_pos_item_remove',{'product':item.rowid}) }}" href="javascript:" class="btn red mini particularDelete"><i class="icon-trash"></i></a>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    {% endif %}

                                                    </tbody>
                                                    <tfoot>
                                                    <tr><td colspan="6" style="border-bottom: 2px solid #004de0">&nbsp;</td></tr>
                                                    <tr>
                                                        <th colspan="4" class="product-title text-right">Sub-Total</th>
                                                        <th id="subTotal" class="product-title">{{ cart.total|number_format(2) }}</th>
                                                        <td></td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="6">{{ form_widget(form.salesBy) }}</td>
                                                    </tr>
                                                    </tfoot>
                                                </table>
                                                <div class="clearfix"></div>
                                                <div class="transaction-box">
                                                    <div class="row-fluid" style="border-bottom: 1px solid #fff; padding-bottom: 15px; margin-bottom: 15px" >
                                                        <div class="span4">
                                                            {{ form_widget(form.discountType) }}
                                                        </div>
                                                        <div class="span4">
                                                            {{ form_widget(form.discountCalculation) }}
                                                        </div>
                                                        <div class="span4">
                                                            {{ form_widget(form.discountCoupon) }}
                                                        </div>
                                                    </div>
                                                    <div class="row-fluid">
                                                        <div class="span6">
                                                            <div class="row-fluid">
                                                                <div class="span6"><span>Discount</span></div>
                                                                <div class="span6"><strong class="discount">{{ cart.discount|number_format(2) }}</strong></div>
                                                            </div>
                                                        </div>
                                                        <div class="span6">
                                                            <div class="row-fluid">
                                                                <div class="span6"><span>Vat</span></div>
                                                                <div class="span6"><strong class="vat">{{ cart.vat|number_format(2) }}</strong></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row-fluid">
                                                        <div class="span6">
                                                            <div class="row-fluid">

                                                            </div>
                                                        </div>
                                                        <div class="span6">
                                                            <div class="row-fluid">
                                                                <div class="span6"><span>Total</span></div>
                                                                <div class="span6"><strong class="total">{{ (cart.total - cart.discount + cart.vat )|number_format(2) }}</strong></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="clearfix"></div>
                                                <div class="row-fluid">
                                                    <div class="span12">
                                                        <div class="switch-method">
                                                            {% set methods = ['Cash','Mobile','Bank'] %}
                                                            {% for method in methods %}
                                                                <input {% if entity.transactionMethod is not empty and entity.transactionMethod.name == method %} checked="checked" {% endif %} type="radio" id="{{ method }}" class="method-process" name="method" value="{{ method }}"/>
                                                                <label  for="{{ method }}">{{ method }}</label>
                                                            {% endfor %}

                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="clearfix"></div>

                                                <div id="cartMethod" class="bankHide">
                                                    <div class="payment-box">
                                                        <div class="row-fluid">
                                                            <div class="span6">{{ form_widget(form.accountBank) }}</div>
                                                            <div class="span3">{{ form_widget(form.paymentCard) }}</div>
                                                            <div class="span3">{{ form_widget(form.cardNo) }}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="bkashMethod" class="mobileBankHide">
                                                    <div class="payment-box">
                                                        <div class="row-fluid">
                                                            <div class="span6">{{ form_widget(form.accountMobileBank) }}</div>
                                                            <div class="span3">{{ form_widget(form.paymentMobile) }}</div>
                                                            <div class="span3">{{ form_widget(form.transactionId) }}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="clearfix"></div>
                                                    <div class="row-fluid">
                                                        <div class="input-prepend input-append span12" >
                                                            <input type="text" style="margin-left:0!important;" id="mobile" name="mobile"  class="span11 m-wrap select2Customer" value=""  autocomplete="off" placeholder="Customer mobile no">
                                                            <span class="add-on add-on-height addCustomer" id="btn-refresh"><i class="icon-user"></i></span>
                                                        </div>
                                                    </div>
                                                    <div class="row-fluid customer" id="">
                                                        <div class="span12 input-append-border">
                                                            <div class="row-fluid">
                                                                <div class="input-icon input-height">
                                                                    <input type="text" id="customerName" name="customerName" class="m-wrap span12 customer-input" autocomplete="off" placeholder="Customer name" value="">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row-fluid customer">
                                                        <div class="span12 input-append-border">
                                                            <div class="row-fluid">
                                                                <div class="input-icon input-height">
                                                                    <input type="text" id="customerMobile" name="customerMobile" class="m-wrap span12 mobile customer-input" autocomplete="off" placeholder="Customer mobile no" value="">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row-fluid customer">
                                                        <div class="span12 input-append-border">
                                                            <div class="row-fluid">
                                                                <textarea id="customerAddress" name="customerAddress" class="m-wrap span12 customer-input" rows="2" placeholder="Enter customer address"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>

                                                <div class="clearfix"></div>
                                                <div class="row-fluid">
                                                    <div class="buttons">
                                                        <div class="row-fluid">
                                                            <div class="span12">

                                                                <input type="button" class="btn cal-button" name="b1" value="1" onClick="calcNumbers(b1.value)">
                                                                <input type="button" class="btn cal-button" name="b2" value="2" onClick="calcNumbers(b2.value)">
                                                                <input type="button" class="btn cal-button" name="b3" value="3" onClick="calcNumbers(b3.value)">
                                                                <input type="button" class="btn cal-button" name="b4" value="4" onClick="calcNumbers(b4.value)">
                                                                <input type="button" class="btn cal-button" name="b5" value="5" onClick="calcNumbers(b5.value)">
                                                                <input type="button" class="btn cal-button" name="b6" value="6" onClick="calcNumbers(b6.value)">
                                                                <input type="button" class="btn cal-button" name="b7" value="7" onClick="calcNumbers(b7.value)">
                                                                <input type="button" class="btn cal-button" name="b8" value="8" onClick="calcNumbers(b8.value)">
                                                                <input type="button" class="btn cal-button" name="b9" value="9" onClick="calcNumbers(b9.value)">
                                                                <input type="button" class="btn cal-button" name="b0" value="0" onClick="calcNumbers(b0.value)">
                                                            </div>
                                                        </div>
                                                        <div class="row-fluid">
                                                            <div class="span12">
                                                                <input type="button" class="btn cal-button-lg" name="b1000" value="1000" onClick="calcGroupNumbers(b1000.value)">
                                                                <input type="button" class="btn cal-button-lg" name="b500" value="500" onClick="calcGroupNumbers(b500.value)">
                                                                <input type="button" class="btn cal-button-lg" name="b300" value="300" onClick="calcGroupNumbers(b300.value)">
                                                                <input type="button" class="btn cal-button-lg" name="b200" value="200" onClick="calcGroupNumbers(b200.value)">
                                                                <input type="button" class="btn cal-button-lg" name="b100" value="100" onClick="calcGroupNumbers(b100.value)">

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="clearfix"></div>

                                            </div>
                                        </div>
                                        <div class="clearfix"></div>
                                        <div class="row-fluid text-center" style="background: #3598dc; padding-top: 15px; padding-bottom: 15px">
                                            <div class="input-prepend input-append span12" >
                                                <span class="add-on add-on-height yellow"><strong id="balance">Due {{ entity.total|number_format(2) }}</strong></span>
                                                {{ form_widget(form.payment) }}
                                                <span class="add-on add-on-height" id="btn-refresh"><strong>C</strong></span>
                                            </div>
                                        </div>
                                        <div class="row-fluid">
                                            <div class="pull-center">
                                                {{ form_widget(form.discount) }}
                                                <input type="hidden" class="" name="invoiceEntity" id="invoiceEntity" value="{{ entity.id }}" >
                                                <input type="hidden" class="total due" name="total" id="total" value="{{ entity.total }}" >
                                                <input type="hidden" class="due" name="due" id="due" value="{{ entity.total }}" >
                                                <input type="hidden" name="discount" id="discount" value="">
                                                <input type="hidden" name="buttonType" id="buttonType" value="posBtn">

                                            </div>
                                        </div>
                                        {{ form_end(form) }}
                                    </div>
                              </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="height: 60px; position: fixed; bottom:0; background: #dddddd; width: 100%; padding-top: 7px">
       <div class="container-fluid">
           <div class="row-fluid" id="process-box">
               <div class="span8">
                   <div class="switch-field">
                       {% set process = ['Order','Kitchen','Hold','Reserved','Free'] %}
                       {% for pro in process %}
                           <input type="radio" data-id="{{ entity.id }}" id="{{ pro }}" {% if pro == entity.process  %} checked="checked" {% endif %} data-action="{#{{ path('restaurant_tableinvoice_process',{'id':entity.id,'process':pro}) }}#}"   class="invoice-process"  name="process" value="{{ pro }}"/>
                           <label for="{{ pro }}">{{ pro }}</label>
                       {% endfor %}
                   </div>
               </div>
               <div class="span4">
                   <div class="row-fluid">
                       <div class="pull-center">
                          {#{% if config.posPrint == 1 and config.payFor == "pre-pay" %}
                               <button type="button" class="btn red big payBtn receiveBtn" {% if entity.subTotal is empty %} disabled="disabled" {% endif %} id="posButton" name="posButton" value="posBtn"><i class="icon-print"></i> BILL PAY</button>
                          {% elseif config.posPrint == 1 and config.payFor == "post-pay" %}
                               <button type="button" class="btn red big receiveBtn" {% if entity.subTotal is empty %} disabled="disabled" {% endif %} id="posButton" name="posButton" value="posBtn"><i class="icon-print"></i> BILL PAY</button>
                           {% endif %}#}
                           <button type="button" class="btn blue big  receiveBtn" {% if entity.subTotal is empty %} disabled="disabled" {% endif %} id="saveButton"><i class="icon-save"></i> SAVE</button>
                       </div>
                   </div>
               </div>
           </div>
       </div>
    </div>
    {#{% if config.posPrint == 1 %}
        <script>
            (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "http://localhost.xiidea.net:9432/assets/easy-print-server.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, "script", "xiidea-epp-sdk"));
        </script>
    {% endif %}#}
{% endblock %}

{% block cssBlock %}
    {% stylesheets filter='cssrewrite'
    '@InventoryBundle/Resources/public/css/pos.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock  %}
{% block javascriptBlock %}
    {{ parent() }}
    {% javascripts
    '@InventoryBundle/Resources/public/js/pos.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock  %}
{% block documentready %}
    {{ parent() }}
{% endblock %}
