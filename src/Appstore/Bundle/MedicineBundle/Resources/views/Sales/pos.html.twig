{% extends '::base.html.twig' %}
{% block body %}
<div class="container-fluid">
    <!-- END PAGE HEADER-->
<div class="portlet-body">
<div class="portlet box green">
<div class="portlet-title">
    <div class="caption"><i class="icon-reorder"></i>Add Medicine/Accessories</div>
    <div class="actions">
        <div class="btn-group">
            <a class="btn black" href="{{ path('medicine_sales') }}"><i class="icon-th-list"></i> SALES </a>
            <a class="btn red" href="{{ path('medicine_sales') }}"><i class="icon-pause"></i> HOLD </a>
            <a class="btn blue" href="{{ path('medicine_stock') }}" target="_blank"><i class="icon-th-list"></i> Stock Item </a>
            <a class="btn yellow instantPopup" href="javascript:" data-url="{{ path('medicine_instant_purchase_add') }}" id="instantPurchasePopup" ><i class="icon-circle-arrow-down"></i> Instant Purchase</a>
            <a href="javascript:" id="globalMedicine"  data-trigger="hover" data-original-title="Global Medicine" class=" btn purple tooltips"><i class="fa fa-angle-double-down"></i> Search Medicine</a>
        </div>
    </div>
</div>
<div class="portlet-body form">
    {% include('flash-message.html.twig')  %}
    <!-- BEGIN FORM-->
    <div class="row-fluid" id="generic-hide">
        <div class="span12">
            <input type="text" id="select2GenericMedicine" name="select2GenericMedicine"  class="m-wrap span12 input select2GenericMedicine" placeholder="Search medicine name" aria-required="true">
        </div>
    </div>
    <div class="loader loader-double" ></div>
    <div id="instantPurchaseLoad"></div>
    <div class="clearfix">&nbsp;</div>
    <div class="row-fluid ">
        <div class="span12">
            <div class="controls">
                <input type="text" id="generic"   name="generic"  class="span12 m-wrap selectStock2Generic" value=""  autocomplete="off"  placeholder="Stock item search by generic name">
            </div>
        </div>
    </div>
    <div class="clearfix">&nbsp;</div>
    <div class="particular-info" style="padding-left:15px!important" >
        <div class="row-fluid ">
            {% if config.barcode == 1 %}
                <div class="span2">
                    <input type="text" id="barcode" autocomplete="off" name="barcode"  class="m-wrap span12 input barcode" placeholder="Barcode" aria-required="true">
                </div>
            {% endif %}
            {{ form_start(salesItem) }}
            {{ form_row(salesItem._token) }}
            <div class="{% if config.barcode == 1 or config.purchaseItem == 1 %} span5 {% else %} span7 {% endif %} ">
                {{ form_widget(salesItem.stockName) }}
                {{ form_errors(salesItem.stockName) }}
            </div>
            {% if config.purchaseItem == 1 %}
                <div class="span2">
                    {{ form_widget(salesItem.purchaseItem) }}
                </div>
            {% endif %}
            <div class="span5">
                <div class="input-append">
                    <div class="input-group">
                        {{ form_widget(salesItem.salesPrice) }}
                        {{ form_errors(salesItem.salesPrice) }}
                        {{ form_widget(salesItem.quantity) }}
                        {{ form_errors(salesItem.quantity) }}
                        {{ form_widget(salesItem.itemPercent) }}
                        <button type="submit" class="btn big blue" id="addTemporaryItem"> <span class="fa fa-shopping-cart"></span> Add</button>
                        <button type="reset" class="btn big yellow" > <span class="fa fa-refresh"></span></button>
                    </div>
                </div>
            </div>
            {{ form_end(salesItem) }}
        </div>

    </div>
    <div class="clearfix">&nbsp;</div>
    <div class="row-fluid">
        <div class="span12" id="particular-table">
            <table class="table table-bordered table-striped table-condensed table-fixed">
                <thead class="flip-content ">
                <tr class="head-blue">
                    {#<th class="span1">&nbsp;&nbsp;<i class="icon-list"></i> Barcode</th>#}
                    <th class="span3">Name</th>
                    <th class="span1">Rack</th>
                    <th class="span1">PP</th>
                    <th class="span1">MRP</th>
                    <th class="span1">Quantity</th>
                    <th class="span1">Discount</th>
                    <th class="span1">Sub-total</th>
                    <th class="span1"><i class="icon-trash"></i></th>
                </tr>
                </thead>
                <tbody id="invoiceParticulars">
                {% if user.medicineSalesTemporary is not empty %}
                    {% for item in user.medicineSalesTemporary %}
                        <tr id="remove-{{ item.id }}">
                            {#<td  class="span1">{% if item.medicinePurchaseItem is not empty %}{{ item.medicinePurchaseItem.barcode }}{% endif %}</td>#}
                            <td class="span5">{{ loop.index }}. {{ item.medicineStock.name }}</td>
                            <td class="span1">{% if item.medicineStock.rackNo is not empty %}{{ item.medicineStock.rackNo.name }}{% endif %}</td>
                            <td class="span1">{{ item.purchasePrice|number_format(2) }}</td>

                            <td class="span1">
                                <input type="hidden" name="salesItem[]" value="{{ item.id }}" >
                                <input type="number" class=" numeric td-inline-input salesPrice" data-id="{{ item.id }}" autocomplete = "off"  id="salesPrice-{{ item.id }}" name="salesPrice" value="{{ item.salesPrice|number_format(2) }}" >
                            </td>
                            <td class="span1">
                                <input type="number" class=" numeric td-inline-input quantity" data-id="{{ item.id }}" autocomplete = "off" min="1" max="{{ item.quantity }}"  id="quantity-{{ item.id }}" name="quantity[]" value="{{ item.quantity }}" placeholder="{{ item.quantity }}"> {% if item.medicineStock.unit is not empty %}<span>{{ item.medicineStock.unit.name }}</span>{% endif %}
                            </td>
                            <td class="span1">{{ item.itemPercent }}</td>
                            <td class="" id="subTotal-{{ item.id }}">{{ item.subTotal|number_format(2) }}</td>
                            <td class="">
                                <a data-id="{{ item.id }}" title="" data-url="{{ path('medicine_sales_temporary_item_update') }}" href="javascript:" class="btn blue mini itemUpdate" ><i class="icon-save"></i></a>
                                <a id="{{ item.id }}" title="Are you sure went to delete ?" data-url="{{ path('medicine_sales_temporary_item_delete',{'id': item.id }) }}" href="javascript:" class="btn red mini temporaryDelete" ><i class="icon-trash"></i></a>
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
                </tbody>
                <tfoot>
                <tr>
                    <td colspan="8" class="span12" style="border: 1px double #000"></td>
                </tr>
                <tr>
                    <td colspan="6" class="span9"><span class="pull-right"><strong>Total TK.</strong> =</span></td>
                    <td class=""><strong id="subTotal">{{ result.subTotal|number_format(2) }}</strong></td>
                    <td class="span1"></td>
                </tr>
                <tr>
                    <td colspan="6" class="span9"><span class="pull-right"><strong>Discount TK.</strong> =</span></td>
                    <td class=""><strong class="discount"></strong></td>
                    <td class="span1"></td>
                </tr>
                <tr>
                    <td colspan="6" class="span9"><span class="pull-right"><strong>Grand-Total TK.</strong> =</span></td>
                    <td class=""><strong id="grandTotal">{{ result.subTotal|number_format(2) }}</strong></td>
                    <td class="span1"></td>
                </tr>
                <tr>
                    <td colspan="6" class="span9"><span class="pull-right"><strong>Profit TK.</strong> =</span></td>
                    <td class=""><strong id="profit">{{ (result.subTotal - result.purchaseSubTotal)|number_format(2) }}</strong></td>
                    <td class="span1"></td>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>
    {{ form_start(form) }}
    {{ form_row(form._token) }}
    <div class="row-fluid">
        <div class="span7">&nbsp;</div>
        <div class="span5 payment-info">
            <div class="row-fluid">
                <div class="span12">
                    <div class="control-group">
                        <label class="control-label" for="firstName">
                            <span class="label" >Discount</span>
                            <span class="pull-right sales-right">
                            {{ form_widget(form.discountCalculation) }}
                            </span>
                            <span class="pull-right sales-right">
                              {{ form_widget(form.discountType) }}
                            </span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="row-fluid">
                <div class="span12">
                    <div class="control-group">
                        <div class="controls">
                            {{ form_widget(form.transactionMethod) }}
                            {{ form_errors(form.transactionMethod) }}
                        </div>
                    </div>
                </div>
                <!--/span-->
            </div>
            <div id="cartMethod" class="bankHide">
                <div class="row-fluid">
                    <div class="span12">
                        <div class="control-group">
                            <div class="controls">
                                {{ form_widget(form.cardNo) }}
                                {{ form_errors(form.cardNo) }}
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <div class="control-group">
                            <div class="controls">
                                {{ form_widget(form.paymentCard) }}
                                {{ form_errors(form.paymentCard) }}
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <div class="control-group">
                            <div class="controls">
                                {{ form_widget(form.accountBank) }}
                                {{ form_errors(form.accountBank) }}
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
            </div>
            <div id="bkashMethod" class="mobileBankHide">
                <div class="row-fluid">
                    <div class="span12">
                        <div class="control-group">
                            <div class="controls">
                                {{ form_widget(form.paymentMobile) }}
                                {{ form_errors(form.paymentMobile) }}
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <div class="control-group">
                            <div class="controls">
                                {{ form_widget(form.transactionId) }}
                                {{ form_errors(form.transactionId) }}
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <div class="control-group">
                            <div class="controls">
                                {{ form_widget(form.accountMobileBank) }}
                                {{ form_errors(form.accountMobileBank) }}
                            </div>
                        </div>
                    </div>
                    <!--/span-->
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="clearfix"></div>
            <div class="row-fluid">
                <div class="span12">
                    <input type="text" style="margin-left: 0!important;" id="mobile" name="mobile"  class="span10 m-wrap select2TemporaryCustomer" value=""  autocomplete="off" placeholder="Customer mobile no">
                    <button class="pull-right btn btn-large green big span2  addTemporaryCustomer"><i class="icon-user"></i></button>
                </div>
            </div>
            <div class="row-fluid customer" id="">
                <div class="span12 input-append-border">
                    <div class="row-fluid">
                        <input type="text" id="customerName" name="customerName" class="m-wrap span12 customer-input" autocomplete="off" placeholder="Customer name" value="">
                    </div>
                </div>
            </div>
            <div class="row-fluid customer">
                <div class="span12 input-append-border">
                    <div class="row-fluid">
                        <input type="text" id="customerMobile" name="customerMobile" class="m-wrap span12 mobile customer-input" autocomplete="off" placeholder="Customer mobile no" value="">
                    </div>
                </div>
            </div>
            <div class="row-fluid customer">
                <div class="span12 input-append-border">
                    <div class="row-fluid">
                        <textarea id="customerAddress" name="customerAddress" class="m-wrap span12 customer-input" rows="2" placeholder="Enter customer address"></textarea>
                    </div>
                </div>
            </div>
            <div class="clearfix"></div>
            <div class="row-fluid ">
                <div class="span12 input-append-border">
                    <div class="row-fluid">
                        {{ form_widget(form.salesBy) }}
                        {{ form_errors(form.salesBy) }}
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <div class="control-group">
                        <label class="control-label" for="firstName"><span class="label" id="balance">Due TK.</span> <span class="pull-right sales-right dueAmount" style="text-align: left; width: 180px; font-size: 40px; color: red"  id="" >{{ result.subTotal|number_format(2) }}</span></label>
                    </div>
                </div>
                <!--/span-->
            </div>
            <div class="clearfix"></div>
            <div class="row-fluid">
                <div class="span12">
                    <div class="control-group">
                        <label class="control-label" style="height: 50px; line-height: 40px!important;background: red"  for="firstName"><span class="label" style="color: #ffffff!important;">Receivable TK.</span> <span class="pull-right sales-right">{{ form_widget(form.received) }}</span></label>
                        <div class="controls">
                            {{ form_errors(form.received) }}
                        </div>
                    </div>
                </div>
                <!--/span-->
            </div>
            <div class="clearfix"></div>
            <div class="row-fluid">
                <div class="span12">
                    <div class="control-group">
                        <label class="control-label" for="firstName"><span class="label" id="balance">Is Hold</span> <span class="pull-right sales-right"  ><input type="checkbox" class="m-wrap checkbox" id="process" name="process" value="Hold"></span></label>
                    </div>
                </div>
                <!--/span-->
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
    <div class="clearfix">&nbsp;</div>
    <div class="form-actions portlet box blue">
        <div class="row-fluid">
            <div class="span8"></div>
            <div class="span4">
                <div class="input-append span12">
                    <div class="btn-group span11">
                        {{ form_widget(form.due) }}
                        {{ form_widget(form.discount) }}
                        <input type="hidden" id="salesNetTotal" name="salesNetTotal" value="{{ result.subTotal }}">
                        <input type="hidden" id="salesSubTotal" name="salesSubTotal" value="{{ result.subTotal }}">
                        <input type="hidden" name="buttonType" id="buttonType" value="">
                        <button type="button" class="btn salesBtn red big {% if config.posPrint == 1 or config.regularPosPrint %} span6 {% else %} span12 {% endif %} " id="receiveBtn" {% if result.subTotal is empty %} disabled="disabled" {% endif %} ><i class="icon-save"></i> SAVE </button>
                        {% if config.posPrint == 1 %}
                        <button type="button" class="btn salesBtn yellow big span6" id="posBtn" {% if result.subTotal is empty %} disabled="disabled" {% endif %} ><i class="icon-print"></i> POS PRINT</button>
                        {% endif %}
                        {% if config.regularPosPrint == 1 %}
                            <button type="button" class="btn salesBtn yellow big span6" id="regularPrint" {% if result.subTotal is empty %} disabled="disabled" {% endif %} ><i class="icon-print"></i> POS PRINT</button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{ form_end(form) }}
    {#<div class="float-sm">
        <div class="fl-fl float-fb">
            <img src="{{ asset('assets/img/shortcut/shift-t4x.png')}}">
            <a href="javascript:">Total Amount</a>
        </div>
        <div class="fl-fl float-tw">
            <img src="{{ asset('assets/img/shortcut/shift-s4x.png')}}">
            <a href="javascript:">Save</a>
        </div>
        <div class="fl-fl float-gp">
            <img src="{{ asset('assets/img/shortcut/shift-t4x.png')}}">
            <a href="javascript:">Print</a>
        </div>
        <div class="fl-fl float-rs">
            <img src="{{ asset('assets/img/shortcut/shift-t4x.png')}}">
            <a href="javascript:">Discount</a>
        </div>
        <div class="fl-fl float-ig">
            <img src="{{ asset('assets/img/shortcut/shift-t4x.png')}}">
            <a href="javascript:">Receive Amount</a>
        </div>
        <div class="fl-fl float-pn">
            <img src="{{ asset('assets/img/shortcut/shift-t4x.png')}}">
            <a href="javascript:">Customer</a>
        </div>
        <div class="fl-fl float-new">
            <img src="{{ asset('assets/img/shortcut/shift-t4x.png')}}">
            <a href="javascript:">New Item</a>
        </div>
    </div>#}
    <!-- END FORM-->
</div>

</div>
</div>

</div>

    <style>
        .bankHide , .mobileBankHide{
            display: none;
        }
        #customerAddress{
            font-size:18px;
        }
        .dialogModal{
            z-index: 9999!important;
        }
        #calBorder, .select2-drop , .select2-drop-mask{
            z-index: 99999!important;
        }
        .select2-container .select2-choice {
            height: 48px!important;
            font-size:18px;
            line-height: 48px;
            border: 2px solid #3598dc!important;
        }
        .select2-container .select2-choice abbr {
            top: 23px;
        }
        .select2-search input {
            border: 2px solid #3598dc!important;
            height: 48px!important;
            font-size:18px;
        }
        .select2-results .select2-result-label {
            padding: 3px 7px 4px;
            margin: 0;
            cursor: pointer;
            min-height: 30px;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            font-size: 18px;
            line-height: 30px;
            font-weight: bold;
        }
        .form-horizontal .payment-info .control-label {
            float: left;
            text-align: left;
            background: #f9f9f9;
            color: #000;
            font-weight: bold;
            line-height: 32px;
            height: 38px;
            margin: 0!important;
            width: 100%;
            font-size:18px;
        }

        .numeric input {
            margin-bottom: 0;
            min-height: 15px!important;
            width: 70px;
            height: 15px!important;
            border: 1px solid #999;
            font-size:18px!important;
            line-height: 15px!important;
        }
        .table-striped tbody>tr:nth-child(odd)>td, .table-striped tbody>tr:nth-child(odd)>th {
            font-size:18px!important;
        }
        table td[class*="span"], table th[class*="span"], .row-fluid table td[class*="span"], .row-fluid table th[class*="span"] {
            font-size:18px!important;
        }
        .table th, .table td {
            font-size:18px;
        }
        select.m-wrap, input[type="file"].m-wrap {
            height: 54px !important;
            margin-top: 0px;
            line-height: 48px;
            font-size:18px!important;
            border: 2px solid #3598dc!important;
        }

        .td-inline-input{
            height: 25px!important;
            line-height: 25px!important;
            font-size:18px!important;
            border: 2px solid #4d90fe!important;
            width: 100px;
            margin-bottom:0!important;
        }
        input[class*="span"].m-wrap {
            height: 54px!important;
            background: #ffffff;
            border: 2px solid #3598dc!important;
            font-size:18px;
        }
        .td-inline-label{
            height: 15px!important;
            line-height: 20px!important;
            min-height: 15px!important;
            font-size: 13px!important;
        }
        .sales-right input[class*="span"]#salesTemporary_received {
            height: 54px!important;
            font-size: 41px!important;
        }
        .sales-right .discount-type {
            height: 40px!important;
            border: 2px solid red !important;
            margin-top: -4px!important;
        }
        .sales-right input[class*="span"].m-wrap {
            font-weight: bold;
            margin-top: -4px;
            text-align: right;
            border: 2px solid red !important;
            height: 40px!important;
        }
        ul.ui-autocomplete li a {
            position: relative;
            height: 32px!important;
            min-height: 32px!important;
            line-height:32px!important;
            text-decoration: none!important;
            padding-left: 1%!important;
            display: inline-block;
            width: 99%!important;
            font-size: 14px;
            font-weight: bold;
        }

        .form-horizontal .payment-info .control-label .label{
            font-size: 18px;
        }
        .select2-container .select2-choice .select2-arrow {
            top: 10px;
        }
        {% if config.printCss is not empty %}
            {{ config.printCss|raw }}
        {% endif %}
    </style>
    {% if config.posPrint == 1 %}
        <script>
            (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "http://localhost.xiidea.net:9432/assets/easy-print-server.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, "script", "xiidea-epp-sdk"));

        </script>
    {% endif %}
{% endblock %}
{% block cssBlock %}
    {% stylesheets filter='cssrewrite'
        '@MedicineBundle/Resources/public/css/dashboard.css'
        '@MedicineBundle/Resources/public/css/invoice.css'
        '@MedicineBundle/Resources/public/css/sidebar-tooltip.css'
    %}
        <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock  %}
{% block javascriptBlock %}
    {{ parent() }}
    {% javascripts
        '@MedicineBundle/Resources/public/js/temporary-sales.js'
        '@MedicineBundle/Resources/public/js/approveProcess.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock  %}
{% block documentready %}
    {{ parent() }}
    $.key('shift+n', function() {
        $('#salesTemporaryItem_stockName').select2('open');
    });
    $.key('shift+b', function() {
        $('.barcode').focus().attr('value', '');
        $('.barcode').attr('value', '').blur();
    });
    $.key('shift+d', function() {
        $('.discount').blur();
    });
    $.key('shift+c', function() {
        $('.customer').focus();
    });
    $.key('shift+r', function() {
        $('.receive').focus();
    });
    $.key('shift+s', function() {
        $('.save').click();
    });
    $.key('shift+p', function() {
        $('.print').click();
    });
    jqueryTemporaryLoad();
    jqueryInstantTemporaryLoad();
    $('#salesTemporaryItem_stockName').focus();
{% endblock %}
