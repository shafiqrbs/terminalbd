<?php

namespace Appstore\Bundle\TicketBundle\Repository;


use Appstore\Bundle\TicketBundle\Entity\TicketBuilderItem;
use Appstore\Bundle\TicketBundle\Entity\TicketFormBuilder;
use Doctrine\ORM\EntityRepository;


/**
 * CategoryMeta
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class TicketBuilderItemRepository extends EntityRepository
{

    public function pageMeta(TicketFormBuilder $builder, $data)
    {

        $em = $this->_em;
        if ($builder and isset($data['labelName']) and !empty($data['labelName'])) {
            
            foreach ($data['labelName'] as $key => $row):

                if (isset($data['labelName'][$key]) and !empty($data['labelName'][$key])) {

                    if (!empty($data['labelName'][$key]) and !empty($data['metaId'][$key])) {
                        $entity = $this->find($data['metaId'][$key]);
                    } elseif (!empty($data['labelName'][$key])) {
                        $entity = new TicketBuilderItem();
                        $entity->setBuilder($builder);
                    }
                    $entity->setFieldType($data['fieldType'][$key]);
                    $entity->setLabelName($data['labelName'][$key]);
                    $entity->setDefaultValue($data['defaultValue'][$key]);
                    $entity->setHelpText($data['helpText'][$key]);
                    if(isset($data['fieldRequired'][$key])){
                        $entity->setFieldRequired($data['fieldRequired'][$key]);
                    }
                    $em->persist($entity);
                    $em->flush();
                }
            endforeach;


        }

    }


}
