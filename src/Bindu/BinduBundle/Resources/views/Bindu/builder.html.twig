{% extends ':bindu:base.html.twig' %}
{% block body %}
    <div id="tm-page-body">
        <div id="tm-template-default-fullwidth" class="tm-container">
            <div class="page-content" style="margin-top: 50px">
                <div class="page-content-inner tm-content">
                    <div id="profileTabList" class="tm-wrap" >


                        <div class="one-half tabs">
                            <a href="#design">Design</a>
                            <a href="#feature">Feature</a>
                            <a href="#tools">Tools</a>
                            <a href="#moduleApp">Module & Apps</a>
                        </div>

                        <div class="one-half last">
                            <section class="tags">
                                <ul>
                                    {% if(entity.subDomain is not empty) %}
                                    <li>
                                        <i class="fa fa-gears"></i><a href="javascript:" id="setting">setting</a>
                                    </li>
                                    <li>
                                        <i class="fa fa-eye"></i><a target="_blank" href="{{ path('bindu_preview') }}">view Sites</a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </section>
                        </div>
                    </div>

                    <div class="tm-row">

                        <div class="tm-wrap">

                            <div class="main-setting"  {% if(entity.subDomain is not null) %} style="display: none" {% endif %}>
                                <div class="main-setting-inner" >
                                    <blockquote class="tm-style1">
                                        <span>Welcome to: {{ entity.name }}</span> {% if(entity.subDomain is not null) %}  <span id="settingMainClose" class="fa-icon"><i class="fa  fa-close"></i></span> {% endif %}
                                    </blockquote>
                                    <br/>
                                    Select from any of the options below to change or customize the look and feel of your mobile site. To edit/add or update content on your mobile site go to the Features and Tools sections. Remember to save changes to your website, click the blue ‘Add to site’ or ‘Update’ buttons.
                                    <br/><br/>First time? Click here for more instructions.
                                    <form class="design-form option" id="optionID"  action="" method="post" >
                                        <label for="domain">Your domain name<a class="small-text align-right"  href="#"
                                                                  data-interface="tooltip"
                                                                  data-position="top"
                                                                  data-content="Enter the name of your company. This name will appear at the top of every page of your mobile site."
                                                                  data-shift="10"
                                                                  data-defineClass = "bord"
                                                                  data-radius = "0px"
                                                    >help</a></label>
                                        <p><span class="fa-icon"><i class="fa  fa-anchor"></i></span><input id="domain" type="text" value="http://{{ entity.domain }}" placeholder="Enter your existing domain name" name="domain">
                                        <span>Follow this example:http://google.com</span>
                                        </p>
                                        <label for="subDomain">Your sub-domain name<a class="small-text align-right"  href="#"
                                                                      data-interface="tooltip"
                                                                      data-position="top"
                                                                      data-content="Enter the name of your sub-domain name. This name will appear at the top of every page of your mobile site."
                                                                      data-shift="10"
                                                                      data-defineClass = "bord"
                                                                      data-radius = "0px"
                                                    >help</a></label>
                                        <p><span class="fa-icon"><i class="fa  fa-anchor"></i></span><input id="subDomain" type="text" value="http://{{ app.request.host }}/{{ entity.subDomain }}" placeholder="Enter your chose any sub-domain name" name="subDomain"></p>
                                        <div class="clear"></div>
                                        <div class="checkbox block">
                                            <label >Customize Design</label><input type="checkbox" name="customizeDesign" {% if(entity.customizeDesign == 1) %} checked {% endif %} value="1" />
                                            <label >SMS Integration</label><input type="checkbox" name="smsIntegration" {% if(entity.smsIntegration == 1) %} checked {% endif %} value="1" />
                                            <label >Email Integration</label><input type="checkbox" name="emailIntegration" {% if(entity.emailIntegration == 1) %} checked {% endif %} value="1" />
                                            <label >Is Promotion</label><input type="checkbox" name="promotion" {% if(entity.promotion == 1) %} checked {% endif %} value="1" />

                                        </div>
                                        <div class="clear"></div>
                                        <p class="align-right" >
                                             To keep these changes, click 'Update'&nbsp;&nbsp;&nbsp;<input type="submit" id="optionBtn" class="align-right tm-btn mini" value="update"></p>
                                    </form>
                                </div>
                            </div>

                            <div class="ajax-loading"></div>
                            <div class="one-half one-half-first ">

                                <div>

                                    <div id="profileTabData" class="both">
                                        <div id="design" class="tab_content scroll"  data-ui="jscroll-example2" >
                                            {{ include ('@Bindu/Builder/design.html.twig')}}
                                        </div>
                                        <div id="feature" class="tab_content scroll"  data-ui="jscroll-example2">
                                            {{ include ('@Bindu/Builder/feature.html.twig')}}
                                        </div>
                                        <div id="tools" class="tab_content scroll"  data-ui="jscroll-example2">
                                            {{ include ('@Bindu/Builder/tools.html.twig')}}
                                        </div>
                                        <div id="moduleApp" class="tab_content scroll"  data-ui="jscroll-example2">
                                            {{ include ('@Bindu/Builder/moduleApp.html.twig')}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="one-half last" style="background:#eee;">
                                <div class="iphone_bg">
                                    <div class="mobile_wrap">
                                        {% if(entity.subDomain is not empty) %}
                                            <iframe id="frame" frameborder="no" border="0" scrolling="no" width="320px" height="568px;" src="{{ path('bindu_mobile_home',{'subdomain':entity.subDomain}) }}"></iframe>
                                        {% endif %}
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>

                    {% if(entity.subDomain ) %}
                        <div class="tm-wrap create-bottom"></div>
                    <div class="header-line-center">
                        <form class="finish" name="finish" action="" method="post">
                         <input name="status" type="hidden" value="1">
                        <button class="tm-btn big"><i class="fa fa-check"></i>&nbsp;Finish</button>
                        </form>
                    </div>
                        <div class="tm-wrap create-bottom"></div>
                    {% endif %}


                </div>
            </div>
            <!--page-content-->
        </div>
        <!--tm-container-->
    </div>

{% endblock %}
{% block documentready %}

    {{ parent() }}

    $("#domain").keydown(function(e) {

        var oldvalue=$(this).val();
        var field=this;
        setTimeout(function () {
        if(field.value.indexOf('http://') !== 0) {
        $(field).val(oldvalue);
        }
        }, 1);

    });

    $("#subDomain").keydown(function(e) {

        var oldvalue=$(this).val();
        var field=this;
        setTimeout(function () {
        if(field.value.indexOf('http://{{ app.request.host }}/') !== 0) {
        $(field).val(oldvalue);
        }
        }, 1);

    });

    $("#facebookPageUrl").keydown(function(e) {

        var oldvalue=$(this).val();
        var field=this;
        setTimeout(function () {
        if(field.value.indexOf('https://facebook.com/') !== 0) {
        $(field).val(oldvalue);
        }
        }, 1);

    });

    $("#googlePlus").keydown(function(e) {

        var oldvalue=$(this).val();
        var field=this;
        setTimeout(function () {
        if(field.value.indexOf('https://plus.google.com/') !== 0) {
        $(field).val(oldvalue);
        }
        }, 1);

    });

    $("#twitterUrl").keydown(function(e) {

        var oldvalue=$(this).val();
        var field=this;
        setTimeout(function () {
        if(field.value.indexOf('https://twitter.com/') !== 0) {
        $(field).val(oldvalue);
        }
        }, 1);

    });

    $('.checkbox :checkbox').rcSwitcher({

        // reverse: true,
        inputs:false,
        // width: 70,
        // height: 24,
        // blobOffset: 2,
        onText: 'Yes',
        offText: 'No',
        theme: 'modern',
        // autoFontSize: true,

    });


    function isValidEmailAddress(emailAddress) {
        var pattern = /^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;
        return pattern.test(emailAddress);
    };

    $('#callBackEmail').focusout(function(){

            var emil=$('#callBackEmail').val();
            if( ! isValidEmailAddress( emil ) ) {
                $('#callBackEmail').val('').addClass('error-input');
                $('#callBackEmailError').html(emil+' is not valid e-mail address.');
            }else{
                $('#callBackEmail').removeClass('error-input');
                $('#callBackEmailError').html('');
            }

    });

    $('#leaveEmail').focusout(function(){

            var emil=$('#leaveEmail').val();
            if( ! isValidEmailAddress( emil ) ) {
                $('#leaveEmail').val('').addClass('error-input');
                $('#leaveEmailError').html(emil+' is not valid e-mail address.');
            }else{
                $('#leaveEmail').removeClass('error-input');
                $('#leaveEmailError').html('');
            }

    });

    $('.timepicker').ptTimeSelect();

    $('.finish').submit( function( e ) {

        $.ajax({
            url:'{{ path('bindu_build_finish') }}',
            type: 'POST',
            data: new FormData(this),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
                $('.ajax-loading').fadeOut(3000);
            },
            complete: function(){
                document.location.reload();
            }
        })
        e.preventDefault();

    });

    $('#Core_userbundle_user_profile_mobile').change(function(){

        var mobile = $(this).val();
        $.ajax({
        url:'{{ path('bindu_user_check') }}',
        type: "POST",
        beforeSend: function() {
        $('#checking').html('<img class="loadingImg" src="{{ asset('assets/img/loader-red.gif') }}" alt="" >');
        },
        data: 'mobile='+ mobile,
        success: function(response) {
        if(response == 'failed'){
        $('#checking').html('Someone already has that mobile no. Try another?').css({'top':0, 'right':0,'width':'auto'});
        $('#Core_userbundle_user_profile_mobile').val('');
        $('#Core_userbundle_user_profile_mobile').css('border','1px solid red');
        }else{
        $('#checking img').fadeOut(3000);
        $('#Core_userbundle_user_profile_mobile').css('border','1px solid #2dbae7');
        }

        }
        });
    });



    $('.option').validate({

        rules: {
            subDomain: {
                url: true
            },
            subDomain: {
                required: true,
                url: true,
                remote: {
                    url: "{{ path('bindu_build_checking_subdomain') }}",
                    type: "post",
                    data:
                    {
                        subDomain: function()
                        {
                        return $('#optionID :input[name="subDomain"]').val();
                        }
                    }
                }
            },


        },
        messages:{
            domain:{
                emailordomain: "Please specify the correct domain name"
            },
            subDomain:{
                required: "Please enter your choseable sub domain name.",
                remote: jQuery.validator.format("{0} is already taken.")
            }
        },
        submitHandler: function(form) {
            $.ajax({
                url:'{{ path('bindu_build_option') }}',
                type: "POST",
                beforeSend: function() {
                 $('.ajax-loading').show().addClass('loading').fadeIn(3000);
                },
                data: $('form.option').serialize(),
                success: function(response) {
                        $('.ajax-loading').fadeOut(3000);
                        $('.main-setting').fadeOut(3500);
                },
                complete: function(){
                    {#document.location.reload();#}
                }
            });
        }

    });

    $('#setting').click(function(){
        $('.main-setting').toggle();
    })

    $('#settingMainClose').click(function(){
        $('.main-setting').fadeOut(3000);
    })


    $('.tm-accordion').on('click', '.accordion-title', function(){
        $(".tm-accordion-setting" ).hide();
        $(this).find( ".tm-accordion-setting" ).show();
    });


    $('.tm-accordion').on('click', 'a.setting-tab,dt.setting-tab', function(){

        var container = $(this).closest('.accordion-title').next();

        $('.setting-tab').removeClass('active');
        $(this).addClass('active');
        $('.setting-hidden').hide();
        container.find("."+$(this).data('ref')).show();
    });


    $('.theme-submitted').submit( function( e ) {

        $.ajax({
            url:'{{ path('bindu_build_template') }}',
            type: 'POST',
            data: new FormData(this),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
            $('.ajax-loading').fadeOut(3000);
            }
        });

        e.preventDefault();

    });

    $('.home-submitted').submit( function( e ) {

        $.ajax({

            url:'{{ path('bindu_build_homepage') }}',
            type: 'POST',
            data: new FormData(this),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
            $('.ajax-loading').fadeOut(3000);
            }
        });

        e.preventDefault();

    });

    $('.customize-submitted').submit(function(e){

        $.ajax({

            url:'{{ path('bindu_build_customize') }}',
            type: 'POST',
            data: new FormData(this),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
            $('.ajax-loading').fadeOut(3000);
            }
        });
            e.preventDefault();
    })

    $('.footer-submitted').submit(function(e){

        $.ajax({

            url: '{{ path('bindu_build_footer') }}',
            type: 'POST',
            data: new FormData(this),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
            $('.ajax-loading').fadeOut(3000);
            }
        });
            e.preventDefault();


    })

    $('.about-us').submit(function(e){

        $.ajax({

            url: '{{ path('bindu_build_about') }}',
            type: 'POST',
            data: new FormData(this),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
            $('.ajax-loading').fadeOut(3000);
            }
            });
            e.preventDefault();


    })

    $('.sitesetting').submit(function(e){

        $.ajax({

            url: '{{ path('bindu_build_sitesetting') }}',
            type: 'POST',
            data: new FormData(this),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
            $('.ajax-loading').fadeOut(3000);
            }
            });
            e.preventDefault();


    })


    var usernameCheck = $('#usernameCheck');

    $('#username').on('keyup', function(){

        var username = $('#username').val();
        if (username.length >= 3) {
            $.ajax({
            type: 'POST',
            cache: 'false',
            data: {username: username}, // form data
            beforeSend: function() {
            // show loading image
            usernameCheck.attr('class', 'usernameLoading');
            },
            success: function(d) {
            console.log(d)
            if (d == 200) {
            // show ok image
            usernameCheck.attr('class', 'usernamePassed');
            }
            else if (d == 201) {
            // show fail image
            usernameCheck.attr('class', 'usernameFail');
            }
            }
            });
        };
    });

    $('.customizeTemplate').submit( function( e ) {

        $.ajax({
            url: '{{ path('bindu_build_template') }}',
            type: 'POST',
            data: new FormData( this ),
            processData: false,
            contentType: false,
            success: function(data){}
        });
        e.preventDefault();

    });

    $('#callEmail').submit( function( e ) {

        $.ajax({
            url: '{{ path('bindu_build_contact') }}',
            type: 'POST',
            data: new FormData( this ),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
            $('.ajax-loading').fadeOut(3000);
            }
            });
            e.preventDefault();

    });

    $('.contact').submit( function( e ) {

        $.ajax({
            url: '{{ path('bindu_build_contact') }}',
            type: 'POST',
            data: new FormData( this ),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
            $('.ajax-loading').fadeOut(3000);
            }
            });
            e.preventDefault();

    });

    $('.adsTool').submit( function( e ) {

        $.ajax({
            url: '{{ path('bindu_build_adsTool') }}',
            type: 'POST',
            data: new FormData( this ),
            processData: false,
            contentType: false,
            beforeSend: function() {
            $('.ajax-loading').show().addClass('loading').fadeIn(3000);
            },
            success: function(response) {
            $('.ajax-loading').fadeOut(3000);
            }
            });
            e.preventDefault();

    });


    $("#district").change(function(){

        var district = $(this).val();
        $.ajax({
        url: '{{ path('bindu_build_find_child') }}',
        type: "POST",
        data: 'district='+ district,
        beforeSend: function() {
            $('#child').html("<img src='{{ asset('assets/global/img/waiting.gif') }}' />").fadeIn(30000);
        }
        }).done(function(child){
            $('#child').html(child);
            $('#thana').select2();
        });

    });

    $('#footerSettingID').click(function(){

        var serialized = $('form#footerSetting').serialize();
        $.ajax({
        url: '{{ path('bindu_build_footer') }}',
        type: "POST",
        data: serialized
        }).done(function(data){});
    })


    $("#logoUpload").change(function(){
        logoPreview(this);
    });

    function logoPreview(input) {

        if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
            $('#logoPreview').show().attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
        }
    }

    $("#bgImage").change(function(){
        bgImagePreview(this);
    });

    function bgImagePreview(input) {

        if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
            $('#bgImagePreview').show().attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
        }
    }

    $("#headerBgImage").change(function(){
        headerBgImagePreview(this);
    });

    function headerBgImagePreview(input) {

        if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
            $('#headerBgImagePreview').show().attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
        }
    }


    $(".theme").click(function () {

        var id = $(this).attr('rel');
        $(".theme").removeClass('themeSelected');
        $("#theme-"+id).addClass('themeSelected');
        $('#themeId').val(id);

    });

{% endblock %}
