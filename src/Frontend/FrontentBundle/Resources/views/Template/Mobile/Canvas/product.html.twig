{% extends ':frontend/template/mobile:ecommerce-base.html.twig' %}
{% block body %}
    <div id="content"  class="product" style="margin-bottom: 50px; margin-top: 47px">
        <div id="cat-search"></div>
            <div class="container" id="product-section">
                <div id="cart-item-list">
                    {% if  cart.contents is not empty %}
                    <div class="top">Recent Buy Item's</div>
                    <div id="cart-item-list-box" class="scrollbar">
                        {% for product in cart.contents %}
                            <dl class="entity-list" id="item-remove-{{ product.rowid }}">
                                <dt>{% if product.productImg is not empty %}
                                        <img src="{{ image(product.productImg).scaleResize(80,80) }}" alt=""/>
                                    {% endif %}
                                    <span class="dd-span-name">{{ product.name }}</span>
                                </dt>
                                <dd>
                             <span class="dd-span-action">
                                <button id="{{ product.rowid }}" data-url="{{ path(globalOption.subDomain ~ '_webservice_product_cart_remove',{'cartid':product.rowid}) }}" class="btn btn-xs btn-danger hunger-remove-cart">
                                    <span class="glyphicon glyphicon-trash"></span>
                                </button>
                            </span>
                                    <span class="dd-span-price" >{{ globalOption.ecommerceConfig.currency }}&nbsp;{{ product.price }}x{{ product.quantity }} = {{  product.price*product.quantity }}</span>
                                </dd>
                            </dl>
                        {% endfor %}
                    </div>
                    <div class="bottom">
                        <span class="dd-span pull-left">SubTotal:</span>
                        <span class="dd-span pull-right"><strong>{{ globalOption.ecommerceConfig.currency }}&nbsp;<span class="totalAmount">{{ cart.total }}</span></strong></span>
                    </div>
                    <div class="bottom">
                        <span class="dd-span pull-left"><a href="{{ path(globalOption.subDomain ~ '_webservice_product_cart_details') }}" class="btn btn-success"><span class="glyphicon glyphicon-shopping-cart"></span> View Buy</a></span>
                        <span class="dd-span pull-right">
                        {% if app.user %}
                        <a href="{{ path('order_checkout',{'shop':globalOption.uniqueCode}) }}" type="button" class="btn btn-success">Checkout <span class="glyphicon glyphicon-play"></span></a>
                        {% endif %}
                        </span>
                    </div>
                    {% else %}
                        <p>You have no products in your shopping Bag.</p>
                    {% endif %}
                </div>
             {#   {% render controller("FrontendBundle:EcommerceWidget:sidebarTemplateProductFilter",{'globalOption':globalOption.id,'searchForm':searchForm}) %}#}
                <div class="row">
                    <div class="bs-callout bs-callout-info bs-callout-custom ">
                        <h4 class="feature-title"><i class="fa fa-th-large"></i> {% if titleName is defined and titleName is not empty %}{{ titleName }}{% else %}All Products{% endif %}</h4>
                        {% if app.request.cookies.has('productList') %}
                            {% set cookieVal = app.request.cookies.get('productList') %}
                        {% else %}
                            {% set cookieVal = 'faThLarge' %}
                        {% endif %}
                        <div class="btn-group btn-group-sm pull-right" role="group" aria-label="Small button group">
                            <button type="button" class="btn btn-default btn-cookie" id="faListAlt" data-url="{{ path(globalOption.subDomain ~ '_webservice_product_cookie_base_list') }}"><i class="fa fa-list-alt"></i></button>
                            <button type="button" class="btn btn-default btn-cookie" id="faThLarge" data-url="{{ path(globalOption.subDomain ~ '_webservice_product_cookie_base_list') }}" ><i class="fa fa-th-large "></i></button>
                            <button type="button" class="btn btn-default btn-cookie" id="faList" data-url="{{ path(globalOption.subDomain ~ '_webservice_product_cookie_base_list') }}" ><i class="fa fa-list"></i></button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    {% for product in products %}
                        {% if cookieVal == 'faThLarge' %}
                            <div class="col-lg-6 col-xs-6 col-md-6 col-sm-6 col-sm-cus-6 fadeInDown animated product-item" data-wow-delay="0.1s" >
                                <div class="thumbnail" >
                                    <div class="product-preview group list-group-image" >
                                        <a href="{{ path(globalOption.subDomain ~ '_webservice_product_details',{'item':product.slug }) }}"> <img class="img-responsive" src="{% if product.webPath is not empty  %}{{ image(product.webPath).forceResize(400,400) }}{% elseif product.masterItem.webPath is defined and product.masterItem.webPath is not empty %}{{ image(product.masterItem.webPath).forceResize(400,400) }}{% endif %}" alt=""></a>
                                    </div>
                                    <div class="row-fluid">
                                        <div class="col-xs-8 col-md-8 text-left product-price"><strong class="currency">{{ globalOption.ecommerceConfig.currency }}</strong> {% if product.discount is not empty  %}<strike>{% endif %}{{ product.salesPrice|number_format() }}{% if product.discount is not empty  %}</strike>{% endif %}{% if product.discount is not empty  %}&nbsp;{{ product.discountPrice|number_format() }}{% endif %}</div>
                                        <div class=" col-xs-4 col-md-4 text-right"><a class="btn btn-sm btn-info product-buy" id="buy-{{ product.id }}" data-id="{{ product.id }}" href="javascript:" data-url="{{ path(globalOption.subDomain ~ '_webservice_product_single_cart',{'product':product.id }) }}"><span class="fa fa-shopping-basket"></span></a></div>
                                    </div>
                                    <div class="caption" data-match-height="item-caption">
                                        <div class="row-fluid">
                                            {% if globalOption.ecommerceConfig.showBrand == 1 %}
                                                <span class="group inner brand text-left" >{% if product.brand is not empty and  globalOption.ecommerceConfig.showBrand == 1 %}{{ product.brand.name }}{% endif %}&nbsp;</span>
                                            {% endif %}
                                            <span class="group inner product-name text-left" ><a href="{{ path(globalOption.subDomain ~ '_webservice_product_modal',{'subdomain': globalOption.subDomain,'item':product.id }) }}">{{ product.webName }}&nbsp;{% if product.masterItem is not empty and  globalOption.ecommerceConfig.showMasterName == 1 %}{{ product.masterItem.name }}{% endif %}</a> </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% elseif cookieVal == 'faListAlt' %}
                        <div class="col-xs-12 col-md-12 list-group-item">
                            <div class="col-xs-4 col-md-4">
                                <a href="{{ path(globalOption.subDomain ~ '_webservice_product_details',{'item':product.slug }) }}" style="margin-top: 20px">
                                    <img class="img-responsive" src="{% if product.webPath is not empty  %}{{ image(product.webPath).forceResize(400,400) }}{% elseif product.masterItem.webPath is defined and product.masterItem.webPath is not empty %}{{ image(product.masterItem.webPath).forceResize(400,400) }}{% endif %}"  alt=""/>
                                </a>
                            </div>
                            <div class="col-xs-8 col-md-8">
                                <div class="row">
                                    <div class="col-xs-12 col-md-12 list-group-product">
                                        {% if product.brand is not empty and  globalOption.ecommerceConfig.showBrand == 1 %}
                                            <span class="group inner brand text-left" >{% if product.brand is not empty and  globalOption.ecommerceConfig.showBrand == 1 %}{{ product.brand.name }}{% endif %}&nbsp;</span>
                                        {% endif %}
                                        <span class="group inner product-name text-left" ><a href="{{ path(globalOption.subDomain ~ '_webservice_product_details',{'item':product.slug }) }}">{{ product.webName }}&nbsp;{% if product.masterItem is not empty and  globalOption.ecommerceConfig.showMasterName == 1 %}{{ product.masterItem.name }}{% endif %}</a> </span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6 col-md-6 text-left product-price"><strong class="currency">{{ globalOption.ecommerceConfig.currency }}</strong> {% if product.discount is not empty  %}<strike>{% endif %}{{ product.salesPrice|number_format() }}{% if product.discount is not empty  %}</strike>{% endif %}{% if product.discount is not empty  %}&nbsp;{{ product.discountPrice|number_format() }}{% endif %}</div>
                                    <div class=" col-xs-6 col-md-6 text-right">
                                        {% if product.discount is not empty  %}<a class="btn btn-danger product-discount btn-xs"  href="javascript:"><span class="glyphicon glyphicon-tag"></span> {{ product.discount.discountAmount }}{% if product.discount.type !='flat' %}%{% endif %}</a>{% endif %}
                                        <button class="btn btn-sm btn-info" type="button"><i class="fa fa-shopping-basket" aria-hidden="true"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% elseif cookieVal == 'faList' %}
                        <div class="col-xs-12 col-md-12">
                            <div class="product-item">
                                <a class="" href="{{ path(globalOption.subDomain ~ '_webservice_product_details',{'item':product.slug }) }}">
                                    <img class="img-responsive" src="{% if product.webPath is not empty  %}{{ image(product.webPath).forceResize(450,450) }}{% elseif product.masterItem.webPath is defined and product.masterItem.webPath is not empty %}{{ image(product.masterItem.webPath).forceResize(450,450) }}{% endif %}"  alt=""/>
                                </a>
                                <div class="caption row" data-match-height="item-promotion">
                                    <div class="row-fluid">
                                        <div class="col-xs-7 col-md-7 text-left product-price"><strong class="currency">{{ globalOption.ecommerceConfig.currency }}</strong> {% if product.discount is not empty  %}<strike>{% endif %}{{ product.salesPrice|number_format() }}{% if product.discount is not empty  %}</strike>{% endif %}{% if product.discount is not empty  %}&nbsp;{{ product.discountPrice|number_format() }}{% endif %}</div>
                                        <div class=" col-xs-5 col-md-5 text-right">
                                            {% if product.discount is not empty  %}<a class="btn btn-danger product-discount btn-xs"  href="javascript:"><span class="glyphicon glyphicon-tag"></span> {{ product.discount.discountAmount }}{% if product.discount.type !='flat' %}%{% endif %}</a>{% endif %}
                                            <a class="btn btn-info btn-sm product-preview" data-title="{{ product.webName }}&nbsp;{% if product.masterItem is not empty and  globalOption.ecommerceConfig.showMasterName == 1 %}{{ product.masterItem.name }}{% endif %}"  data-dialogmodal-bind=".dialog_content" data-topoffset="0" data-top="10%" data-type="modal" href="javascript:" id="buy-{{ product.id }}" data-id="{{ product.id }}" data-url="{{ path(globalOption.subDomain ~ '_webservice_product_modal',{'item':product.id }) }}"><span class="fa fa-shopping-basket"></span></a>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-md-12 product-attr">
                                        <span class="group inner brand text-left" >{% if product.brand is not empty and  globalOption.ecommerceConfig.showBrand == 1 %}{{ product.brand.name }}{% endif %}&nbsp;</span>
                                        <span class="group inner product-name text-left" ><a href="{{ path(globalOption.subDomain ~ '_webservice_product_details',{'item':product.slug }) }}">{{ product.webName }}&nbsp;{% if product.masterItem is not empty and  globalOption.ecommerceConfig.showMasterName == 1 %}{{ product.masterItem.name }}{% endif %}</a> </span>
                                    </div>

                               </div>
                            </div>
                        </div>
                        {% endif %}
                   {% endfor %}
                </div>
                <div class="clearfix"></div>
                <div class="row">
                <div class="bs-callout bs-callout-info bs-callout-custom ">
                    <div class="row">
                        <div class="{% if knp_pagination_render(products) is empty %} col-xs-12 col-md-12 col-md-cus-12 {% else %} col-xs-6 col-md-6 col-md-cus-6 {% endif %} ">
                            <div class="input-group">
                                <span class="input-group-btn">
                                <button class="btn btn-info btn-sm page-button"><span class="fa fa-sort-numeric-asc"></span></button>
                                </span>
                                {% set sortBy = app.request.get('sortBy') %}
                                <select name="sortBy" id="sortBy" class="input-selector item-select" onchange='this.form.submit()'>
                                    <option {% if sortBy == ''  %} selected="selected" {% endif %} value="" >-- Sorting by --</option>
                                    <option {% if sortBy == 'product.name=?=ASC'  %} selected="selected" {% endif %} value="product.name=?=ASC">Name (A - Z)</option>
                                    <option {% if sortBy == 'product.name=?=DESC'  %} selected="selected" {% endif %} value="product.name=?=DESC">Name (Z - A)</option>
                                    <option {% if sortBy == 'brand.name=?=ASC'  %} selected="selected" {% endif %} value="brand.name=?=ASC">Brand (A - Z)</option>
                                    <option {% if sortBy == 'brand.name=?=DESC'  %} selected="selected" {% endif %} value="brand.name=?=DESC">Brand (Z - A)</option>
                                    <option {% if sortBy == 'product.salesPrice=?=ASC'  %} selected="selected" {% endif %} value="product.salesPrice=?=ASC">Price (Low &gt; High)</option>
                                    <option {% if sortBy == 'product.salesPrice=?=DESC'  %} selected="selected" {% endif %} value="product.salesPrice=?=DESC">Price (High &gt; Low)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-xs-6 col-md-6 col-md-cus-6 pull-right"> {{ knp_pagination_render(products) }}</div>
                    </div>
                </div>
            </div>
        </div><!-- end container -->
    </div>
    <div id="dialog_content" class="dialog_content" style="display:none">
        <div class="dialogModal_header"></div>
        <div class="dialogModal_content"></div>
    </div>
   <style>
       .dialogModal .dialogModal_content {
           padding: 15px;
           line-height: 20px;
           min-height: 200px;
       }

     #cart-item-list {
         border:1px solid  #f5f5f5;
         margin: 10px auto;
     }

     #cart-item-list #cart-item-list-box{
         overflow-y:auto;
     }

     #cart-item-list dl {
         border-bottom: 1px solid #f5f5f5;
         margin: 0 auto;
         overflow: hidden;
         padding: 10px;
     }
     #cart-item-list dt{
         font-weight: normal;
     }
     #cart-item-list dt img {
         border: 1px solid #fafafa;
         float: left;
         margin: 0 15px 0 0;
     }
     #cart-item-list dd {
         margin-top: 10px;
         overflow: auto;
     }

     #cart-item-list .bottom {
         background-color: #f5f5f5;
         color: #000;
         height: 40px;
         line-height: 40px;
         margin-top: 10px;
         overflow: auto;
         text-align: center;
     }

     #cart-item-list .top {
         background-color: #f5f5f5;
         height: 40px;
         line-height: 40px;
         overflow: auto;
         padding-left: 11px;
         text-align: left;
     }

     #cart-item-list .dd-span{
         padding-left: 10px;
         padding-right: 10px;
     }
     #cart-item-list .dd-span-name{
         display: inline-block;
         width: 70%;
         text-align: left;
         height: 43px;
         overflow: hidden;
     }
     #cart-item-list .dd-span-action{
         display: inline-block;
         width: 13%;
         text-align: left;
     }
     #cart-item-list .dd-span-price{
         display: inline-block;
         width: 85%;
         text-align: right;
     }

     #cart-item-list  p{
         padding-top: 5px;
         text-align: center;
         color: red;
         font-size: 12px;
     }
     .popModal{
         max-width: 370px!important;
         left: 18px!important;
         top:46px;
     }
     .popModal:after, .popModal:before{
         border: 0!important;
     }

 </style>
{% endblock %}
{% block cssBlock %}
    {% stylesheets filter='cssrewrite'
    '@FrontendBundle/Resources/public/template/mobile/css/product-canvas.css'
    %}
    <link rel="stylesheet" href="{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock  %}
{% block javascriptBlock %}
    {% javascripts
    '@FrontendBundle/Resources/public/template/mobile/js/common.js'
    '@FrontendBundle/Resources/public/template/mobile/js/product.js'
    %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}
{% block documentready %}
    {{ parent() }}

    $('body').on('click', '.product-next-prev', function(e) {
        var url = $(this).attr('data-url');
        $.ajax({url:url}).done(function(content){
            $('.dialogModal_content').html(content);
        });
    });

    $('.product-preview').click(function(){
    var url = $(this).attr('data-url');
    var dataTitle = $(this).attr('data-title');
    $('.dialogModal_header').html(dataTitle);
    $('.dialog_content').dialogModal({
        topOffset: 0,
        top: 0,
        type: '',
        onOkBut: function(event, el, current) {},
        onCancelBut: function(event, el, current) {},
        onLoad: function(el, current) {
            $.ajax({url:url}).done(function(content){
            el.find('.dialogModal_content').html(content);
            });
        },
        onClose: function(el, current) {},
        onChange: function(el, current) {}
        });
    });


    var itemArr = $.cookie('productList') ? $.cookie('productList'): 'faThLarge';
    $("#"+itemArr).addClass('btn-active');
    $('body').on('click', '.btn-cookie', function(el) {
        var val = $(this).attr('id');
        var url = $(this).attr('data-url');
        $.cookie('productList', val, {path: '/'});
        setTimeout(location.reload(), 1000);
    });
    $('body').on('click', '.btn-sorted', function(el) {
        $("#sortBy").focus();
    });
    $('body').on( "click", "#filter", function(e){
        $('#productFilter').slideToggle('2000');
        $("span", this).toggleClass("fa-close fa-filter");
    });

{% endblock %}



