<?php

namespace Setting\Bundle\AppearanceBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * EcommerceMenuRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class EcommerceMenuRepository extends EntityRepository
{
    public function setOrdering($data)
    {

        $i = 1;
        $em = $this->_em;
        $qb = $em->createQueryBuilder();

        foreach ($data as $key => $value){

            $qb->update('SettingAppearanceBundle:EcommerceMenu', 'mg')
                ->set('mg.sorting', $i)
                ->where('mg.id = :id')
                ->setParameter('id', $key)
                ->getQuery()
                ->execute();
            $i++;

        }
    }

    public function getActiveMenus($subdomain)
    {
        $option = $this->_em->getRepository('SettingToolBundle:GlobalOption')->findOneBy(array('subDomain' => $subdomain));
        return $this->findBy(
            array('status' => true,'globalOption' => $option),
            array('sorting'=>'asc')
        );
    }
}
